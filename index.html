<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sopa de Letras - 5 Niveles</title>
<style>
  body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    margin: 0; padding: 20px; text-align: center; color: #333;
    transition: background-color 0.8s ease;
    user-select: none;
  }
  h1 {
    display: inline-block;
    padding: 10px 30px;
    border-radius: 15px;
    box-shadow: 0 0 10px rgba(0,0,0,0.15);
    margin-bottom: 20px;
  }
  .board {
    display: grid;
    grid-template-columns: repeat(6, 45px);
    justify-content: center;
    gap: 8px;
    margin: 0 auto 25px;
    background-color: #FFF3E0;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 0 15px rgba(255, 183, 77, 0.5);
    max-width: fit-content;
  }
  .cell {
    width: 45px; height: 45px;
    background: white;
    border: 2px solid #F6BD60;
    font-size: 1.6rem;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    border-radius: 8px;
  }
  .cell.highlighted {
    background: #FFD54F;
    border-color: #FFB300;
    color: #5D4037;
    font-weight: bold;
    text-decoration: underline;
  }
  .cell.found {
    background: #4CAF50 !important;
    color: white !important;
    cursor: default;
  }
  .word-list {
    background-color: #FFE4C4;
    padding: 15px 25px;
    border-radius: 15px;
    display: inline-block;
    box-shadow: 0 0 10px #f3bca1;
    margin-bottom: 30px;
  }
  .word {
    display: inline-block;
    margin: 10px 18px;
    font-size: 1.4rem;
    font-weight: 600;
    color: #6D4C41;
  }
  .word.found {
    text-decoration: line-through;
    color: #388E3C;
  }
  /* Colores para cada nivel */
  body.level1 { background-color: #F7E6D9; }
  body.level1 h1 { background-color: #FFD6BA; color: #6D4C41; }
  body.level1 .board { background-color: #FFF3E0; border-color: #F6BD60; }
  body.level1 .cell { border-color: #F6BD60; }

  body.level2 { background-color: #D0E6A5; }
  body.level2 h1 { background-color: #B6D7A8; color: #386641; }
  body.level2 .board { background-color: #E5F0B3; border-color: #A3C78D; }
  body.level2 .cell { border-color: #A3C78D; }

  body.level3 { background-color: #A4D4FF; }
  body.level3 h1 { background-color: #7EB9FF; color: #264D73; }
  body.level3 .board { background-color: #CDE7FF; border-color: #7EB9FF; }
  body.level3 .cell { border-color: #7EB9FF; }

  body.level4 { background-color: #FFE0F0; }
  body.level4 h1 { background-color: #FFB3D9; color: #6D3A59; }
  body.level4 .board { background-color: #FFD1E6; border-color: #FF99CC; }
  body.level4 .cell { border-color: #FF99CC; }

  body.level5 { background-color: #E0FFF7; }
  body.level5 h1 { background-color: #99F0E0; color: #31766F; }
  body.level5 .board { background-color: #B3FFF1; border-color: #66E0D9; }
  body.level5 .cell { border-color: #66E0D9; }
</style>
</head>
<body class="level1">
  <h1 id="title">Sopa de Letras - Nivel 1</h1>
  <div class="board" id="board"></div>
  <div class="word-list" id="wordList"></div>

<script>
  const levels = [
    { title: "Animales Básicos", words: ["GATO", "PERRO", "LEON", "RATA", "OSO"], colorClass: "level1" },
    { title: "Frutas", words: ["PERA", "LIMA", "KIWI", "UVA", "MELA"], colorClass: "level2" },
    { title: "Colores", words: ["AZUL", "ROJO", "VERDE", "GRIS", "ORO"], colorClass: "level3" },
    { title: "Partes del Cuerpo", words: ["MANO", "PIE", "OJO", "NARIZ", "BOCA"], colorClass: "level4" },
    { title: "Objetos", words: ["LATA", "LIBRO", "PELO", "SILLA", "RELOJ"], colorClass: "level5" }
  ];

  const boardSize = 6;
  const board = document.getElementById("board");
  const wordList = document.getElementById("wordList");
  const title = document.getElementById("title");

  let currentLevel = 0;
  let isDragging = false;
  let highlightedCells = [];
  let foundWords = new Set();

  function createEmptyBoard(size) {
    return Array.from({ length: size }, () => Array(size).fill(""));
  }

  function fillRandomLetters(grid) {
    const letters = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";
    return grid.map(row => row.map(cell => cell || letters[Math.floor(Math.random() * letters.length)]));
  }

  function placeWords(grid, words) {
    words.forEach((word, index) => {
      let placed = false;
      let tries = 0;
      while (!placed && tries < 100) {
        const vertical = Math.random() > 0.5;
        const maxRow = vertical ? grid.length - word.length : grid.length;
        const maxCol = vertical ? grid[0].length : grid[0].length - word.length;

        const row = Math.floor(Math.random() * maxRow);
        const col = Math.floor(Math.random() * maxCol);

        let canPlace = true;
        for (let i = 0; i < word.length; i++) {
          const r = vertical ? row + i : row;
          const c = vertical ? col : col + i;
          if (grid[r][c] !== "") {
            canPlace = false;
            break;
          }
        }

        if (canPlace) {
          for (let i = 0; i < word.length; i++) {
            const r = vertical ? row + i : row;
            const c = vertical ? col : col + i;
            grid[r][c] = word[i];
          }
          placed = true;
        }
        tries++;
      }
    });
  }

  function renderBoard(grid) {
    board.innerHTML = "";
    grid.forEach((row, rIdx) => {
      row.forEach((letter, cIdx) => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = letter;
        cell.dataset.row = rIdx;
        cell.dataset.col = cIdx;

        // Eventos para arrastrar mouse y touch
        cell.addEventListener('mousedown', startDrag);
        cell.addEventListener('mouseenter', dragOver);
        cell.addEventListener('mouseup', endDrag);

        cell.addEventListener('touchstart', startDrag);
        cell.addEventListener('touchmove', dragOverTouch);
        cell.addEventListener('touchend', endDrag);

        board.appendChild(cell);
      });
    });
  }

  function startDrag(e) {
    e.preventDefault();
    if (e.target.classList.contains('found')) return;
    isDragging = true;
    clearHighlights();
    highlightCell(e.target);
  }

  function dragOver(e) {
    e.preventDefault();
    if (!isDragging) return;
    if (e.target.classList.contains('found')) return;
    if (highlightedCells.length > 0) {
      const lastCell = highlightedCells[highlightedCells.length - 1];
      if (!isNeighbor(lastCell, e.target)) return;
    }
    highlightCell(e.target);
  }

  function dragOverTouch(e) {
    e.preventDefault();
    if (!isDragging) return;
    const touch = e.touches[0];
    const elem = document.elementFromPoint(touch.clientX, touch.clientY);
    if (!elem || !elem.classList.contains('cell')) return;
    if (elem.classList.contains('found')) return;
    if (highlightedCells.length > 0) {
      const lastCell = highlightedCells[highlightedCells.length - 1];
      if (!isNeighbor(lastCell, elem)) return;
    }
    highlightCell(elem);
  }

  function endDrag(e) {
    e.preventDefault();
    if (!isDragging) return;
    isDragging = false;
    checkSelection();
  }

  function highlightCell(cell) {
    if (!highlightedCells.includes(cell)) {
      highlightedCells.push(cell);
      cell.classList.add('highlighted');
    }
  }

  function clearHighlights() {
    highlightedCells.forEach(cell => cell.classList.remove('highlighted'));
    highlightedCells = [];
  }

  function isNeighbor(cellA, cellB) {
    const rA = parseInt(cellA.dataset.row);
    const cA = parseInt(cellA.dataset.col);
    const rB = parseInt(cellB.dataset.row);
    const cB = parseInt(cellB.dataset.col);

    const dr = rB - rA;
    const dc = cB - cA;

    return (dr === 0 && Math.abs(dc) === 1) || (dc === 0 && Math.abs(dr) === 1);
  }

  function getSelectedWord() {
    return highlightedCells.map(cell => cell.textContent).join('');
  }

  function checkSelection() {
    if (highlightedCells.length === 0) return;

    const word = getSelectedWord();
    const reversed = word.split('').reverse().join('');
    const currentWords = levels[currentLevel].words;

    if (currentWords.includes(word) || currentWords.includes(reversed)) {
      if (!foundWords.has(word) && !foundWords.has(reversed)) {
        markWordFound(word);
        speakWord(word);
        foundWords.add(word);
        foundWords.add(reversed);
        markWordInList(word);
        markWordInList(reversed);
        if (foundWords.size / 2 === currentWords.length) {
          setTimeout(() => {
            nextLevel();
          }, 1000);
        }
      }
    } else {
      clearHighlights();
    }
  }

  function markWordFound(word) {
    highlightedCells.forEach(cell => {
      cell.classList.add('found');
      cell.classList.remove('highlighted');
      cell.style.cursor = 'default';
    });
    highlightedCells = [];
  }

  function markWordInList(word) {
    [...wordList.children].forEach(div => {
      if (div.textContent === word || div.textContent === word.split('').reverse().join('')) {
        div.classList.add('found');
      }
    });
  }

  function speakWord(word) {
    if ('speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(word);
      utterance.lang = 'es-ES';
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utterance);
    }
  }

  function renderWordList() {
    wordList.innerHTML = "";
    levels[currentLevel].words.forEach(w => {
      wordList.innerHTML += `<div class="word">${w}</div>`;
    });
  }

  function nextLevel() {
    currentLevel++;
    if (currentLevel >= levels.length) {
      alert("¡Felicidades! Completaste todos los niveles.");
      currentLevel = 0; // Reiniciar niveles
    }
    foundWords.clear();
    clearHighlights();
    setupLevel();
  }

  function setupLevel() {
    document.body.className = levels[currentLevel].colorClass;
    title.textContent = "Sopa de Letras - " + levels[currentLevel].title;
    const emptyGrid = createEmptyBoard(boardSize);
    placeWords(emptyGrid, levels[currentLevel].words);
    const filledGrid = fillRandomLetters(emptyGrid);
    renderBoard(filledGrid);
    renderWordList();
  }

  setupLevel();
</script>
</body>
</html>

